{% extends 'staf/base_staf.html' %}
{% block title %}Tambah Siswa{% endblock %}
{% block content %}
<div class="container mt-4">
  <h4 class="mb-3"><i class="bi bi-person-plus-fill"></i> Tambah Siswa</h4>

  <form method="post" action="{{ url_for('staf_siswa.tambah_siswa') }}">
    <div class="mb-3">
      <label class="form-label fw-semibold">NIS</label>
      <input type="text" name="nis" class="form-control" placeholder="Masukkan NIS" required>
    </div>

    <div class="mb-3">
      <label class="form-label fw-semibold">Nama</label>
      <input type="text" name="nama" class="form-control" placeholder="Masukkan nama siswa" required>
    </div>

    <div class="mb-3">
      <label class="form-label fw-semibold">Kelas</label>
      <select name="kelas" class="form-select" required>
        <option value="">-- Pilih Kelas --</option>
        {% for k in semua_kelas %}
          <option value="{{ k }}">{{ k }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label fw-semibold">Status</label>
      <select name="status" class="form-select">
        <option value="Aktif">Aktif</option>
        <option value="Nonaktif">Nonaktif</option>
      </select>
    </div>

    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-success"><i class="bi bi-save"></i> Simpan</button>
      <a href="{{ url_for('staf_siswa.daftar_siswa') }}" class="btn btn-secondary"><i class="bi bi-arrow-left"></i> Kembali</a>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function() {
  const inputNIS = document.querySelector("input[name='nis']");
  const infoBox = document.createElement("div");
  infoBox.className = "mt-1 small";
  inputNIS.parentNode.appendChild(infoBox);

  inputNIS.addEventListener("input", function() {
    const nis = this.value.trim();
    if (nis.length < 3) {
      infoBox.innerHTML = "<span class='text-muted'>Masukkan minimal 3 digit NIS untuk cek...</span>";
      return;
    }

    fetch(`{{ url_for('staf_siswa.cek_nis') }}?nis=${encodeURIComponent(nis)}`)
      .then(res => res.json())
      .then(data => {
        if (data.status === "exists") {
          infoBox.innerHTML = `
            <div class="alert alert-warning py-1 px-2 mt-2 mb-0" role="alert">
              ⚠️ ${data.message}<br>
              <small>Atas nama: <b>${data.nama}</b> (${data.kelas})</small>
            </div>
          `;
        } else if (data.status === "available") {
          infoBox.innerHTML = `
            <div class="alert alert-success py-1 px-2 mt-2 mb-0" role="alert">
              ✅ ${data.message}
            </div>
          `;
        } else {
          infoBox.innerHTML = `
            <div class="alert alert-danger py-1 px-2 mt-2 mb-0" role="alert">
              ${data.message}
            </div>
          `;
        }
      })
      .catch(() => {
        infoBox.innerHTML = `
          <div class="alert alert-danger py-1 px-2 mt-2 mb-0" role="alert">
            Gagal memeriksa NIS.
          </div>
        `;
      });
  });
});
</script>
{% endblock %}
